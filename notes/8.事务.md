# 第八章 事务



## 事务

核心：完整性

完整性的威胁: 网络故障、并发

一致性条件：两个贱户总和在转账前后保持不变

### 事务的定义

事务是由一系列操作序列构成的执行单元，这些操作要么都做，要么都不做，是一个不可分割的工作单位

#### 事务中的数据访问原语

<img src="./8.事务.assets/CleanShot 2024-05-11 at 14.43.04@2x.png" alt="CleanShot 2024-05-11 at 14.43.04@2x" style="zoom:50%;" />

#### 转账事务的原语表达

银行转帐：事务T以A帐户过户50¥到B帐户

read (A);
A : = A - 50;
write (A);
read(B);
B := B + 50;
write (B);

### SQL中事务的定义

事务以Begin transaction 开始，以Commit transaction或 Rollback transaction结束

Commit transaction表示提交，事务正常结束

Rollback transaction表示事务非正常结束，撤消事务已做的操作，回滚到事务开始时状态

#### 基于SQL编写转账事务

<img src="./8.事务.assets/CleanShot 2024-05-11 at 14.46.13@2x.png" alt="CleanShot 2024-05-11 at 14.46.13@2x" style="zoom:50%;" />

#### 事务中的错误检查

<img src="./8.事务.assets/CleanShot 2024-05-11 at 14.48.02@2x.png" alt="CleanShot 2024-05-11 at 14.48.02@2x" style="zoom:50%;" />

事务中的错误检查：MySQL

<img src="./8.事务.assets/CleanShot 2024-05-11 at 14.48.17@2x.png" alt="CleanShot 2024-05-11 at 14.48.17@2x" style="zoom:50%;" />

### 事务基本特性ACID

原子性（Atomicity）

一致性（Consistency）

隔离性（Isolation）

持久性（Durability）