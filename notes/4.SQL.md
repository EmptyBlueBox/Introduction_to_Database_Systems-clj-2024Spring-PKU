# 第四章 SQL

## SQL简介

### SQL的起源

SQL: Struceured Query Languang
1974年，由Boyce和Chamber提出，称为Sequel
1975-1979年，在System R上实现，由IBM San Jose研究室研制

### SQL语言的特点

语言简洁，易学易用

面向集合的操作方式：一次一集合

高度非过程化：用户只需提出“做什么”，无须告诉“怎么做”，不必了解存取路径

一体化
集DDL，DML，DCL于一体，单一的结构——关系，带来了数据操作符的统一

两种使用方式，统一的语法结构：既是自含式（用户使用）的，又是嵌入式的（程序员使用）

### SQL的标准化

### SQL主要操作符

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.16.23@2x.png" alt="CleanShot 2024-03-19 at 16.16.23@2x" style="zoom:30%;" />

### SQL：数据访问的事实标准

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.16.43@2x.png" alt="CleanShot 2024-03-19 at 16.16.43@2x" style="zoom:30%;" />

### 约定俗成：提供一个类SQL接口

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.17.07@2x.png" alt="CleanShot 2024-03-19 at 16.17.07@2x" style="zoom:30%;" />

## SQL数据模式定义

### 标准SQL中的数据定义对象

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.19.59@2x.png" alt="CleanShot 2024-03-19 at 16.19.59@2x" style="zoom:30%;" />

### 实际数据库中的定义对象： SQL Server

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.20.13@2x.png" alt="CleanShot 2024-03-19 at 16.20.13@2x" style="zoom:30%;" />

### 术语讨论：模式

MySQL：模式即是数据库

SQL Server：模式把对家和用户分离开来

对象命名：〈数据库〉.〈模式〉.〈表〉

创建模式
create schema < 模式名＞
create schema University.Library

### 数据库定义： SQL Server

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.24.29@2x.png" alt="CleanShot 2024-03-19 at 16.24.29@2x" style="zoom:30%;" />

最简单的创建数据库的命令：create database University
use 命令指定当前要使用的数据库：use University

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.24.55@2x.png" alt="CleanShot 2024-03-19 at 16.24.55@2x" style="zoom:30%;" />

create database ＜ 数据库名＞
[ default character set utf8
default collate utf8_Chinese_ci ]

create database 等同于 create schema

### MySQL表空间

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.27.20@2x.png" alt="CleanShot 2024-03-19 at 16.27.20@2x" style="zoom:30%;" />

### 创建基本表的语法命令

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.27.35@2x.png" alt="CleanShot 2024-03-19 at 16.27.35@2x" style="zoom:40%;" />

#### 创建表示例

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.28.00@2x.png" alt="CleanShot 2024-03-19 at 16.28.00@2x" style="zoom:40%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.28.10@2x.png" alt="CleanShot 2024-03-19 at 16.28.10@2x" style="zoom:40%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.28.24@2x.png" alt="CleanShot 2024-03-19 at 16.28.24@2x" style="zoom:40%;" />

### 修改基本表

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.29.06@2x.png" alt="CleanShot 2024-03-19 at 16.29.06@2x" style="zoom:40%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.29.40@2x.png" alt="CleanShot 2024-03-19 at 16.29.40@2x" style="zoom:40%;" />

### 删除基本表

drop table 表名

drop table不能删除被foreign key约束所引用的表，必须先除去foreign key约束或引用表

任何引用已删除表的视图或存储过程必须通过drop view或drop procedure语句显式除去

DANGER：刪除表定义及该表的所有数据、索引、触发器、约束和权限规范

### 表定义相关的字典表： SQL Server

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.33.29@2x.png" alt="CleanShot 2024-03-19 at 16.33.29@2x" style="zoom:40%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.33.44@2x.png" alt="CleanShot 2024-03-19 at 16.33.44@2x" style="zoom:40%;" />

### 标准SQL中的信息视图

INFORMATION_ SCHEMA.SCHEMATA
INFORMATION SCHEMA. TABLES
INFORMATION_SCHEMA.COLUMNS
INFORMATION_SCHEMA.CHECK_CONSTRAINTS
INFORMATION_SCHEMA.VIEWS
INFORMATION_SCHEMA.DOMAINS

### MySQL中的信息视图查询

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.34.19@2x.png" alt="CleanShot 2024-03-19 at 16.34.19@2x" style="zoom:30%;" />

### SQL数据定义特点

SQL中，任何时候都可以执行一个数据定义语包，随时修改数据库结构

- 数据库定义不断增长（不必一开始就定义完整）
- 数据库定义随时修改（不必一开始就完全合理）
- 可进行增加索引、撤消索引的实验，检验其效率影响



- 在非关系型数据库系统中，必须在数据库使用前全部完成数据库定义
- 若要修改已投入运行的数据库，则需停下一切数据库活动，卸出数据库，修改数据库定义并重新编译，再按修改后的数据库结构重新装入数据

思考：MySQL是如何实现alter table的？新建一个表，drop旧表

## SQL数据类型定义

### 数据类型全家福

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.35.48@2x.png" alt="CleanShot 2024-03-19 at 16.35.48@2x" style="zoom:30%;" />

### 整型

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.36.48@2x.png" alt="CleanShot 2024-03-19 at 16.36.48@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.37.46@2x.png" alt="CleanShot 2024-03-19 at 16.37.46@2x" style="zoom:40%;" />

溢出：

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.44.04@2x.png" alt="CleanShot 2024-03-19 at 16.44.04@2x" style="zoom:40%;" />

宽松模式、严格模式：

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.44.37@2x.png" alt="CleanShot 2024-03-19 at 16.44.37@2x" style="zoom:30%;" />

### 定点数与浮点数

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.44.54@2x.png" alt="CleanShot 2024-03-19 at 16.44.54@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.45.04@2x.png" alt="CleanShot 2024-03-19 at 16.45.04@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.45.14@2x.png" alt="CleanShot 2024-03-19 at 16.45.14@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.45.23@2x.png" alt="CleanShot 2024-03-19 at 16.45.23@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.45.32@2x.png" alt="CleanShot 2024-03-19 at 16.45.32@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.45.43@2x.png" alt="CleanShot 2024-03-19 at 16.45.43@2x" style="zoom:30%;" />

### money数据类型

money使用4位小数存储数据，容易发生小数的舍入错误

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.45.57@2x.png" alt="CleanShot 2024-03-19 at 16.45.57@2x" style="zoom:30%;" />

### 如何给女朋友解释为什么计算机中0.2+ 0.2 +0.1 不等于 0.3 ？

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.46.35@2x.png" alt="CleanShot 2024-03-19 at 16.46.35@2x" style="zoom:30%;" />

### 字符型

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.46.49@2x.png" alt="CleanShot 2024-03-19 at 16.46.49@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.46.59@2x.png" alt="CleanShot 2024-03-19 at 16.46.59@2x" style="zoom:30%;" />

#### 定义者的选择： char or varchar ?

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.47.27@2x.png" alt="CleanShot 2024-03-19 at 16.47.27@2x" style="zoom:30%;" />

变长之利：减少存储开销 ＋ 元组数/页 高

变长之弊：查询计算偏移 ＋ 更新挪移数据

变长之用：长短显著不一+ 很少发生变化

### 字符集

字符集（character set）：字符＋编码

字符序（collation）：字符比较规则
•宇符按其编码比较大小
•如果两个字符为大小写关系，则它们相等

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.48.41@2x.png" alt="CleanShot 2024-03-19 at 16.48.41@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.49.11@2x.png" alt="CleanShot 2024-03-19 at 16.49.11@2x" style="zoom:30%;" />

### 日期型数据类型

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.51.27@2x.png" alt="CleanShot 2024-03-19 at 16.51.27@2x" style="zoom:30%;" />

使用：

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.55.03@2x.png" alt="CleanShot 2024-03-19 at 16.55.03@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.55.16@2x.png" alt="CleanShot 2024-03-19 at 16.55.16@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.55.29@2x.png" alt="CleanShot 2024-03-19 at 16.55.29@2x" style="zoom:30%;" />

UNIX时间戳

### 日期类型：SQL Server

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.55.46@2x.png" alt="CleanShot 2024-03-19 at 16.55.46@2x" style="zoom:30%;" />

格里高利改历法

### 枚举型

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.56.32@2x.png" alt="CleanShot 2024-03-19 at 16.56.32@2x" style="zoom:30%;" />

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.56.41@2x.png" alt="CleanShot 2024-03-19 at 16.56.41@2x" style="zoom:30%;" />

### 二进制类型

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.56.54@2x.png" alt="CleanShot 2024-03-19 at 16.56.54@2x" style="zoom:30%;" />

### 显式数据类型转换

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.57.29@2x.png" alt="CleanShot 2024-03-19 at 16.57.29@2x" style="zoom:30%;" />

### 隐式数据类型转换

如果不指定显式类型转换，那么在对两个不同数据类型的列值进行运算时，系统会进行隐式类型转换，也即先将它们转换为同一个数据类型，然后再进行运算

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.57.47@2x.png" alt="CleanShot 2024-03-19 at 16.57.47@2x" style="zoom:30%;" />

### 用户定义数据类型UDDT:User-defined datatype

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.58.01@2x.png" alt="CleanShot 2024-03-19 at 16.58.01@2x" style="zoom:30%;" />

### 用户定义数据类型： SQL Server

<img src="./4.SQL.assets/CleanShot 2024-03-19 at 16.58.16@2x.png" alt="CleanShot 2024-03-19 at 16.58.16@2x" style="zoom:30%;" />

### 特殊类型

XML
JSON
空间数据
数据类型决定了数据牢适用范围
