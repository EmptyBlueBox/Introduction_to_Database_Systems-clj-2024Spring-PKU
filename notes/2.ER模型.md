# 第二章 E-R 模型

## 基本概念

实体-联系模型:（ER模型，Entity-Relationship Model）

### 实体

实体：客观存在，相互区分

- 属性：实体所具有的某一特性，可以有多个
    - 域（Domain）：属性的取值范围

### 实体型（Entity Type）

实体型（Entity Type）：实体名＋属性名，如学生（学号、姓名、年龄、性别、系、年级）

- 实体（值）：实体型的一个特例，如（9808100，王平，21，男，计算机系，2）是一个实体
- 实体集（Entity Set）：同型实体的集合，如全体学生，但是实体集比全体实体型的集合可能要小

### 联系

联系：实体之间的相互关联

- 联系也可以有属性，如学生与课程之间有选课联系，每个选课联系都有一个成绩
- 联系的元（Degree）：参与联系的实体集的个数学生选修课程是二元联系，供应商向工程供应零件则是三元联系
- 一些问题：
    - 学生与学生的班长联系是几元联系？1
    - 有时称一元联系为递归联系，道理何在？领导的领导的领导：实体集内部的递归
    - 联系是发生在实体集之间的还是实体型之间的？实体集，比如北大同学和清华同学是两个实体集，但是是同一个实体型，实体集更细化一些

### 亚里士多德之辩谬篇

- 你有一只钢笔
    它是蓝色的
    所以它是一只蓝色的钢笔
    它是你的
    所以你有一只蓝色的钢笔

- 你有一条狗
    它是有儿女的
    所以它是一个父亲
    它是你的
    所以它是你的父亲

第一个蓝色是实体属性，第二个是父亲是实体联系，这说明实体属性是附属于实体的，而实体联系不附属

课堂练习：<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 15.50.21@2x.png" alt="CleanShot 2024-02-27 at 15.50.21@2x" style="zoom:30%;" />

### 基本E -R图要点

- 一般模型

    <img src="./2.ER模型.assets/CleanShot 2024-02-27 at 15.36.56@2x.png" alt="CleanShot 2024-02-27 at 15.36.56@2x" style="zoom:30%;" />

- 一元联系

    <img src="./2.ER模型.assets/CleanShot 2024-02-27 at 15.37.43@2x.png" alt="CleanShot 2024-02-27 at 15.37.43@2x" style="zoom:30%;" />

- 一个实体集只能有一个方块

### ER图的连通性

- ER图适合操作型操作，这样的蜘蛛网**不适合分析型操作**

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 15.45.55@2x.png" alt="CleanShot 2024-02-27 at 15.45.55@2x" style="zoom:30%;" />

- 但是星形状的图适合分析型操作，中心的借阅记录，周围是利用这个数据的不同分析

### 习近平 入主 中南海，陈立军 讲授 数据库

- 这是错误的，不能写实体的名字，要写实体集的名字

### 实体的码（Key）

- 超码（superkey）：能唯一标识实体的属性或属性组
    - 超码的任意超集也是超码

- 候选码（candidate key）
    - 其任意真子集都不能成为超码的最小超码

- 主码（primary key）：从所有候选码中选定一个用来区别同一实体集中的不同实体
    - 如学号是学生实体的主码
    - 一个实体集中任意两个实体在主码上的取值不能相同

- 下面实体集的候选码有哪些？**<u>能够唯一确定实体</u>**
    通讯录（姓名，**<u>住址</u>**，**<u>座机</u>**，**<u>微信号</u>**，**<u>Email</u>**, MP）
    上课通知单（课程号、课程名、任课老师、**<u>教室号、上课时间</u>**）

### 联系的码

1. 学生和老师之间的“导师”联系：可以用学生的码作为联系的码
2. 学生和课程之间的“选修”联系：只能用学生+课程整体作为联系的码
3. 联系的种类：一对一、一对多、多对多，可以据此确定联系的码
4. 实体集属性中作为主码的一部分的属性用下划线来标明

### 许多码

1. 替代码：除去主码之外的候选码，VP
2. 代理码：人工码，只起唯一标识作用的序列号，ssn（美国社保号，没有任何可以辨识的信息）
3. 自然码：一个与行中属性有還辑联系的候选码，它是实体的“真正的”属性，比如院系名
4. 智能码：经过编码的标识符，比如X JV 1023 293 9 2 000123，身份证、千年虫

### 简单属性 VS 复合属性

把相关属性聚集起来以反映更高层次的概念，可以使模型更清晰

1. 简单属性：不可再分的属性，如学号、年龄、性别

2. 复合属性（Composite）：可以划分为更小的属性，如电话号码=区号 + 本地号码、出生日=年+月+日

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.20.26@2x.png" alt="CleanShot 2024-02-27 at 16.20.26@2x" style="zoom:30%;" />

### 单值属性 VS 多值属性

1. 单值属性：每一个特定的实体在该属性上的取值唯一，如学生（学号，年龄、性别、系别）

2. 多值属性：某个特定实体在该属性上有多于一个的取值，如学生（学号，所选课程，联系电话）

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.21.53@2x.png" alt="CleanShot 2024-02-27 at 16.21.53@2x" style="zoom:30%;" />

### 派生属性

派生属性（Derived）：可以从其他相关的属性或实体派生出来的属性值
学生（学号，姓名，绩点），选课（学号，课程号，成绩），则绩点可由学生所选课程的成绩计算得来，称绩点为派生属性，成绩为基属性，或存储属性

数据库中，一般只存基属性值，而派生属性只存其定义或依赖关系，用时再从基属性中计算出来

基属性：基本表（模式）、派生属性：视图（外模式）

### NULL属性

#### null表示“值未知”
值存在，但目前没有获得该信息

如职工（姓名，部门，工种，身份证），如果目前不知道，职工身份证号码，则设身份证值为null

类比：墨镜人眼睛的颜色

#### null表示“无意义”
当实体在某个属性上没有值时设为null

如通讯录（姓名，email，电话，MP），若某人没有email地址，则在email属性上取值为null

如员工（姓名，学历，学位，…），若员工没有接受过高等教育，则其学位信息为null

类比：汽车眼睛的颜色

#### NULL属性对数据库设计的影响

如果不支持NULL，数据库就无法录入缺失部分信息的实体、无法将稍具差异的实体放入同一模式中

三值逻辑：true, false, unkown，存在着非真既假和非假既真之间的灰色地带

实体完整性：主码取值不能为null，保证实体一定是相互可区分的

### 各种属性在E-R图中的表示

多值属性用双椭圆表示

派生属性用虛椭圆表示

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.26.12@2x.png" alt="CleanShot 2024-02-27 at 16.26.12@2x" style="zoom:30%;" />

### 联系的种类

实体之间的联系的数量，即一个实体通过一个联系集能与另一实体集相关联的实体的数目

一对一的（1:1）
一对多的（1:m）
多对多的（m:n）

### 联系种类在E-R图中的表示

用箭头或线段来表示联系的种类

箭头指向单方实体集 = 多方实体的箭头指向联系集 = 在多方实体和联系之间的线段上标注字母，在单方实体和联系之间的线段上标注数字1

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.38.53@2x.png" alt="CleanShot 2024-02-27 at 16.38.53@2x" style="zoom:30%;" />

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.39.08@2x.png" alt="CleanShot 2024-02-27 at 16.39.08@2x" style="zoom:30%;" />

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.39.45@2x.png" alt="CleanShot 2024-02-27 at 16.39.45@2x" style="zoom:30%;" />

### 二元联系的种类

注：一对一不是一一对应

一对一的（1:1）
一对多的（1:m）
多对多的（m:n）

### 多元联系

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.41.10@2x.png" alt="CleanShot 2024-02-27 at 16.41.10@2x" style="zoom:30%;" />

每个职工只有一个工种 OR 每个职工在每个部门只有一个工种？？？

每个职工在每个部门只有一个工种因为否则部门就没用了，不如表示成二元联系

* 多元联系中最多允许出现一个箭头

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.44.09@2x.png" alt="CleanShot 2024-02-27 at 16.44.09@2x" style="zoom:50%;" />

（学生，环估报告）-›老师？抑或（学生，评估报告，项目）->老师？所以不允许这样画图

### 联系的势：表达了一个实体出现在联系中的次数

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.45.27@2x.png" alt="CleanShot 2024-02-27 at 16.45.27@2x" style="zoom:30%;" />

区分强制性和可选性联系

### 其它

- 弱实体集：一个实体集的所有属性都不足以形成主码
- 特化：实体集中某些子集具有区别于该实体集内其它实体的特性，可以根据这些差异特性对实体集进行分组，这一分组的过程称作特化
    - 学生：本科生，研究生，使得联系的对象更精确
- 概化：各个实体集根据共有的性质，合成一个较高层的实体集。概化是一个高层实体集与若干个低层实体集之间的包含关系
- 聚集：两个实体集以及它们的联系可被看成实体集，和另一实体集发生联系
    - 一个看上去的三元联系实则是两个先后动作的序列
    - 职工、项目、机器

## 基于业务描述的ER设计实例

设计关键：如何抽象订单？将其作为买家、卖家、商品之间的三元联系？还是直接将订单抽象为实体？

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.49.14@2x.png" alt="CleanShot 2024-02-27 at 16.49.14@2x" style="zoom:30%;" />

### 参与（Participation）

“职工”与“部门”之间的“经理”联系：职工实体集部分参与，而部门实体集完全参与

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.56.51@2x.png" alt="CleanShot 2024-02-27 at 16.56.51@2x" style="zoom:30%;" />

### 角色

实体在联系中的作用称为实体的角色

对于一元联系，为区别各实体参与联系的方式，需要**<u>显式指明</u>**其角色

学生之间的班长关系
职工之问的经理关系
课程之间的先修关系

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.58.05@2x.png" alt="CleanShot 2024-02-27 at 16.58.05@2x" style="zoom:50%;" />

当需要显式区分角色时，在连接菱形和矩形的线上加上说明性标注以区别不同的角色

### 存在依赖 (Existence Dependency)

X存在依赖于y：实体X的存在依赖于实体y的存在

如果y被删除，则x也要被删除

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 16.59.47@2x.png" alt="CleanShot 2024-02-27 at 16.59.47@2x" style="zoom:50%;" />

存在依赖必是完全参与：还款存在依赖于贷款，则还款全部参与和贷款之间的属于联系

### 复合实体

<img src="./2.ER模型.assets/CleanShot 2024-02-27 at 17.00.13@2x.png" alt="CleanShot 2024-02-27 at 17.00.13@2x" style="zoom: 25%;" />

## 扩展ER特性

### 弱实体集 (Weak Entity Set)

弱实体集：一个实体集的所有属性都不足以形成主码

标识性联系（identifying relationship）：弱实体集与其拥有者之间的联系，弱实体集与强实体集之间是一对多的联系

弱实体集必然存在，依赖于强实体集⇔存在依赖并不总会导致一个弱实体集，从属实体集可以有自己的主码

#### 如何对贷款与还款之间的联系建模？引入弱实体集

把还款作为普通实体？

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.17.20@2x.png" alt="CleanShot 2024-03-05 at 15.17.20@2x" style="zoom:30%;" />

问题：还款的所有属性都不能作为主码？把贷款号借给还款实体

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.17.41@2x.png" alt="CleanShot 2024-03-05 at 15.17.41@2x" style="zoom:30%;" />

问题：贷款号冗余？把还款作为多值属性

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.24.08@2x.png" alt="CleanShot 2024-03-05 at 15.24.08@2x" style="zoom:30%;" />

问题：还款概念消失了，还款会和帐户发生支付联系？把还款作为复合属性

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.24.34@2x.png" alt="CleanShot 2024-03-05 at 15.24.34@2x" style="zoom:30%;" />

问题：还款作为复合属性，不能和帐户发生联系？人生若只如初见，概念上这是最清晰的表达，唯一的障碍是还款不能抽象为实体

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.25.00@2x.png" alt="CleanShot 2024-03-05 at 15.25.00@2x" style="zoom:30%;" />

解决途径：把还款作为一种特珠实体加以定义即可

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.25.17@2x.png" alt="CleanShot 2024-03-05 at 15.25.17@2x" style="zoom:30%;" />

#### 弱实体集的分辩符

分辨符（Discriminator）：弱实体集中用于区别依赖于某个特定强实体集的属性集合，也称作部分码（partial key）

弱实体集的主码=强实体集的主码＋弱实体集的分辨符

“还款”主码=贷款号＋还款号

#### 弱实体集在E-R图中的表示

弱实体集以双边框的矩形表示

弱实体集的分辨符用下划虚线标明

标识性联系以双边框的菱形表示

从联系集用双线（全部参与）连接弱实体集，用箭头（一对多联系）指向强实体集

#### 弱实体集的更多示例

Email = 用户名＋主机名，如 fork@pku.edu.cn

Logins（passwd文件）实体集记录本机用户名及其口令，用户名在不同主机上可以相同

Logins是一个弱实体集

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.28.23@2x.png" alt="CleanShot 2024-03-05 at 15.28.23@2x" style="zoom:30%;" />

#### 何时引入弱实体集？

作为层次结构的一部分 cs.pku.edu.cn

实体集的一些多值、复合属性 贷款的还款属性可以抽取出来作为弱实体集

如果弱实体集不但参与和强实体集之间的标识性联系，而且参与和其它实体集的联系，或者弱实体集本身含有很多属性，则将其表述为弱实体集

#### 引入弱实体后的订单ER图

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.31.51@2x.png" alt="CleanShot 2024-03-05 at 15.31.51@2x" style="zoom:30%;" />

### 特化

实体集中某些子集具有区别于该实体集内其它实体的特性，可以根据这些差异特性对实体集进行分组，这一分组的过程称作持化

• 银行帐号特化力存款帐号、贷款帐号
• 学生特化 研究生、本科生

自顶向下、逐步求精的数据库设计过程

子类=特例=更小的实体集=更多的属性

细化：父类→子类

#### 特化在E-R图中的表示

特化用标记为ISA的三角形来表示ISA ="is a”，表示高层实体和低层实体之间的“父类——子类”联系

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.36.12@2x.png" alt="CleanShot 2024-03-05 at 15.36.12@2x" style="zoom:30%;" />

#### 特化使得联系的对象更精确

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.37.26@2x.png" alt="CleanShot 2024-03-05 at 15.37.26@2x" style="zoom:30%;" />

#### 特化使得联系的种类更精确

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.38.08@2x.png" alt="CleanShot 2024-03-05 at 15.38.08@2x" style="zoom:30%;" />

### 概化

* 各个实体集根据共有的性质，合成一个较高层的实体集。
* 体现一个高层实体集与若干个低层实体集之间的包含关系
* 对应自底向上、逐步合成的数据库设计过程
* 泛化：子类→父类

概化 Vs 特化

- 概化与特化是互逆的，在E-R图中的表示方法相同
- 特化强调同一实体集内不同实体之间的差异
- 概化强调不同实体集之间的相似性
- 反映了数据库设计的不同方法

#### 概化中的属性继承

高层实体集的属性被低层实体集自动继承

低层实体集特有的性质仅适用于某个特定的低层实体集，如“Dissertation”只适用于“研究生”实体集

两种继承结构：

- 层次结构(Hierarchy)：实体集作为低层实体集只能参与到一个ISA联系中
- 格结构(Lattice)：低层实体集可以参与到多个ISA联系中

#### 格结构概化中的属性继承

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.46.06@2x.png" alt="CleanShot 2024-03-05 at 15.46.06@2x" style="zoom:30%;" />

“博士”继承了“研究生”与“职工”的所有属性
如果“研究生”与“职工” 有相同名称的属性，如“姓名”，可以在“博士” 中用“研究生。姓名”，“职工。姓名”区别开来

#### 概化中的成员身份

成员身份：同一个概化中，一个高层实体是否可以属于多个不同低层实体集

两种成员身份：

- 不相交的(Disjoint)：一个实体至多属于一个低层实体集，如一个学生只能参加一个项目组
- 有重叠的(Overlapping)：同一实体可同时属于同一概化的多个低层实体集，如一个老师可以参加多个项目组

#### 概化中的全部性约束

全部性约束：确定高层实体集中的一个实体是否必须属于至少一个低层实体集

两种全部性约束：

- 全部的(Total)：每个高层实体必须属于一个低层实体集，如学生必须属于本科生或研究生的一种
- 部分的(Partial)：允许一些高层实体不属于任何低层实体集，如学生可以不属于任何项目组

#### 概化中的约束设计

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.52.43@2x.png" alt="CleanShot 2024-03-05 at 15.52.43@2x" style="zoom:30%;" />

#### 某些书籍中关于不同概化类型的符号表示

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.53.28@2x.png" alt="CleanShot 2024-03-05 at 15.53.28@2x" style="zoom:30%;" />

双线代表全部

### 聚集

#### 如何表达联系之间的联系？

某些联系之间存在重叠

实例：职工参加项目，并在此过程中可能使用机器

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.57.07@2x.png" alt="CleanShot 2024-03-05 at 15.57.07@2x" style="zoom:30%;" />

问题：作为三元联系，有些职工并不和机器发生联系，不雅驯的命名对于ER是个大问题

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 15.57.28@2x.png" alt="CleanShot 2024-03-05 at 15.57.28@2x" style="zoom:30%;" />

职工号 项目号 工时
e1 j1 3
e1 jl 4

职工号 机器号
el  m1
e1 m2

问题：el在jl项目中使用什么机器？聚集

一个看上去的三元联系实则是两个先后动作的序列

实体集A与B以及它们的联系可被看成实体集，然后与另一实体集C发生联系

- 聚集是一种抽象
- 通过聚集将联系抽象为高层实体集

#### 引入聚集后的ER图：

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.06.17@2x.png" alt="CleanShot 2024-03-05 at 16.06.17@2x" style="zoom:30%;" />

## ER模型设计要点

选择恐惧症（强迫症 拖延症 完美癖）
你的目标是什么？
选项利弊是什么？

### 实体 VS 属性

实体有多方面性质，属性没有

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.14.33@2x.png" alt="CleanShot 2024-03-05 at 16.14.33@2x" style="zoom:30%;" />

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.15.31@2x.png" alt="CleanShot 2024-03-05 at 16.15.31@2x" style="zoom:30%;" />

弊端：若多个老师开同一门课，则每个老师与该课程的联系都需重复记录很多相同的信息

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.19.20@2x.png" alt="CleanShot 2024-03-05 at 16.19.20@2x" style="zoom:30%;" />

有一些属性根本不是刻画“讲述”这个联系的

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.23.05@2x.png" alt="CleanShot 2024-03-05 at 16.23.05@2x" style="zoom:30%;" />

### 能否把多元联系转换为若干个二元联系？

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.28.30@2x.png" alt="CleanShot 2024-03-05 at 16.28.30@2x" style="zoom:30%;" />

能否用实体之间的二元联系替换三元联系？

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.28.48@2x.png" alt="CleanShot 2024-03-05 at 16.28.48@2x" style="zoom:30%;" />

不可以：

1. 有损：多出来了新的三元联系
2. 联系的属性：供货数量qty无处安放

### 多重动作叠加起来的三元联系

一个项目由多个部门资助，一个部门资助多个项目，每个资助协议由一个或多个雇员监督

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.30.00@2x.png" alt="CleanShot 2024-03-05 at 16.30.00@2x" style="zoom:30%;" />

这种叠加联系有时会在属性与其归属联系的匹配上出现语义模糊：资助有起始时间，监督有截止时间

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.31.29@2x.png" alt="CleanShot 2024-03-05 at 16.31.29@2x" style="zoom:30%;" />

聚集替代三元：多重联系叠加

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.32.01@2x.png" alt="CleanShot 2024-03-05 at 16.32.01@2x" style="zoom:30%;" />

什么时候用聚集替换三元联系？当三元联系是复合动作的时候

## 概念数据库设计过程

不重要

### 局部ER设计

### 全局ER设计

全局ER设计中的消除冲突

### 全局ER优化
## ER模型向关系模式的转换

### 实体向关系模式的转换

一个实体一张表

实体→关系
属性→关系的属性

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.37.06@2x.png" alt="CleanShot 2024-03-05 at 16.37.06@2x" style="zoom:30%;" />

### 复合属性向关系模式的转换

复合属性定义为视图，或由应用定义

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.38.45@2x.png" alt="CleanShot 2024-03-05 at 16.38.45@2x" style="zoom:30%;" />

### 多值属性向关系模式的转换

要将多值属性和主码再创建一个新的表

多值属性→新的关系＋所在实体的码

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.40.06@2x.png" alt="CleanShot 2024-03-05 at 16.40.06@2x" style="zoom:30%;" />

### 一对多联系向关系模式的转换

#### 实体集之间的一对多关系

将单方参与实体的码作为多方参与实体的属性

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.40.55@2x.png" alt="CleanShot 2024-03-05 at 16.40.55@2x" style="zoom:30%;" />

可以继续优化，把关系表合并到学生表中

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.42.27@2x.png" alt="CleanShot 2024-03-05 at 16.42.27@2x" style="zoom:30%;" />

#### 实体集内部的一对多关系

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.45.04@2x.png" alt="CleanShot 2024-03-05 at 16.45.04@2x" style="zoom:30%;" />

### 多对多联系向关系模式的转换

#### 实体集之间的多对多关系

将联系定义为新的关系，属性为参与双方的码

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.47.11@2x.png" alt="CleanShot 2024-03-05 at 16.47.11@2x" style="zoom:30%;" />

#### 实体集内部的多对多关系

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.47.27@2x.png" alt="CleanShot 2024-03-05 at 16.47.27@2x" style="zoom:30%;" />

### 一对一联系向关系模式的转换

若联系双方均部分参与，则将联系定义为一个新的关系，属性为参与双方的码

对于这种不完全参与的联系，不要对每一个人都给出一个配偶号列

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.51.02@2x.png" alt="CleanShot 2024-03-05 at 16.51.02@2x" style="zoom:30%;" />

若联系一方全部参与，则将联系另一方的码作为全部参与一方的属性

对于这种完全参与的联系，对每一个人都给出一个部门号列

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.51.43@2x.png" alt="CleanShot 2024-03-05 at 16.51.43@2x" style="zoom:30%;" />

### 弱实体向关系模式的转换

弱实体集所对应的关系的码由弱实体集本身的分辩符再加上所依赖的强实体集的码

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.52.23@2x.png" alt="CleanShot 2024-03-05 at 16.52.23@2x" style="zoom:30%;" />

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.52.56@2x.png" alt="CleanShot 2024-03-05 at 16.52.56@2x" style="zoom:30%;" />

### 概括向关系模式的转换

高层实体集和低层实体集分别转为表，低层实体集所对应的关系包括高层实体集的码

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.57.52@2x.png" alt="CleanShot 2024-03-05 at 16.57.52@2x" style="zoom:30%;" />

如果概括是不相交并且是全部的，则可以不为高层实体集建立关系，低层实体集所对应的关系包括上层实体集的的所有属性

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.58.06@2x.png" alt="CleanShot 2024-03-05 at 16.58.06@2x" style="zoom:30%;" />

### 聚集向关系模式的转换

实体集A与B及其联系R被抽象成实体集C，C与易一实体集D构成联系S，则S的码由C和D的码构成

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.58.56@2x.png" alt="CleanShot 2024-03-05 at 16.58.56@2x" style="zoom:30%;" />

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.59.08@2x.png" alt="CleanShot 2024-03-05 at 16.59.08@2x" style="zoom:30%;" />

### 课堂练习：下面聚集向关系模式的转换结果

<img src="./2.ER模型.assets/CleanShot 2024-03-05 at 16.59.32@2x.png" alt="CleanShot 2024-03-05 at 16.59.32@2x" style="zoom:30%;" />

## 逆向工程：关系模式向ER的转换

不能先把每一个表都转成一个ER图，这是错误的，因为属性有重叠

<img src="./2.ER模型.assets/CleanShot 2024-03-11 at 11.08.35@2x.png" alt="CleanShot 2024-03-11 at 11.08.35@2x" style="zoom:30%;" />

### 逆向转换的关键：识别关系间的重合属性

重合属性体现了实体之间的联系

首先要观察：Tb1拥有Tb2的主码，那么Tb1到Tb2是一个多对一的（但是不一定是完全参与的，完全参与是双线）

其次：Tb4又拥有两个表的主码，它大概就是一个多对多的联系

<img src="./2.ER模型.assets/CleanShot 2024-03-11 at 11.11.57@2x.png" alt="CleanShot 2024-03-11 at 11.11.57@2x" style="zoom:30%;" />

###  作业中的几个疑点

转会就像淘宝，交易也有ID

这几个图不能反映转入和转出，自己写的时候要可以反应转入和转出

<img src="./2.ER模型.assets/CleanShot 2024-03-11 at 20.53.21@2x.png" alt="CleanShot 2024-03-11 at 20.53.21@2x" style="zoom:30%;" />

### 如何对时态进行概念建模？

员工可以在多个部门工作，但在一段时期内只能在一个部门工作

如图无法处理时间段overlap的问题，很难在ER图中表示，所以应该用文字记录

<img src="./2.ER模型.assets/CleanShot 2024-03-11 at 20.55.23@2x.png" alt="CleanShot 2024-03-11 at 20.55.23@2x" style="zoom:30%;" />

### 空中楼阁：如何对旅游路线概念建模？

<img src="./2.ER模型.assets/CleanShot 2024-03-11 at 20.56.31@2x.png" alt="CleanShot 2024-03-11 at 20.56.31@2x" style="zoom:30%;" />

## ER模型总结

概念模型：人脑中的信息世界

概念模型：清晰、清晰、第三个清晰

数据组织必须契合处理需求
	操作型应用：ER模型，适合事务处理，微观操作OLTP：t: transaction
	分析型应用：星型模型，适合OLAP，a: analysis

## 补充内容

不要求
